// ============================================================================
// Header Component Styles with Accessibility Enhancements
// ============================================================================
// NOTE: Global focus styles are centralized in src/styles/generic/_generic.scss
// Component-specific focus styles below only override when needed for special cases
// ============================================================================

.c-header {
  z-index: 1030; // Increased from 1000 for better stacking context
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  
  // Make all dropdowns scrollable
  .dropdown-menu {
    max-height: 80vh; // Limit to 80% of viewport height
    overflow-y: auto !important; // Enable vertical scrolling - important to override
    overflow-x: hidden; // Prevent horizontal scroll
    width: auto !important; // Let content determine width
    max-width: 90vw !important; // Allow wrapping at high zoom
    min-width: 0 !important; // Remove Bootstrap's default min-width
    
    // Ensure dropdowns are scrollable at high zoom (400%)
    @include respond-below(sm) {
      max-height: 70vh; // Slightly smaller at narrow widths
    }
    
    // On desktop at high zoom, ensure dropdown can be wider
    @include respond-above(lg) {
      max-width: 50vw !important; // Allow more width on desktop
    }
    
    // Ensure dropdown items don't truncate text at high zoom
    .dropdown-item {
      white-space: normal !important; // Allow text wrapping
      word-wrap: break-word !important; // Break long words
      overflow-wrap: break-word !important; // Modern alternative
      min-width: 0 !important; // Allow items to shrink
      max-width: 100% !important; // Respect parent width
      padding: rem-calc(8 16) !important; // Ensure adequate padding
      display: block !important; // Use block for better wrapping
      min-height: 44px !important; // Touch target size
      line-height: 1.5 !important; // Better line spacing for wrapped text
      
      @include respond-below(lg) {
        width: 100% !important; // Full width on mobile
      }
      
      &:focus-visible {
        outline: 2px solid currentColor !important;
        outline-offset: -2px !important;
      }
      
      // Disabled items styling
      &.disabled {
        opacity: 0.5 !important;
        pointer-events: none !important;
        cursor: not-allowed !important;
      }
      
      // Active language styling
      &.active {
        background-color: var(--bs-primary) !important;
        color: var(--bs-white) !important;
        font-weight: 600 !important;
        
        &:hover,
        &:focus {
          background-color: var(--bs-primary) !important;
          color: var(--bs-white) !important;
        }
      }
    }
    
    // Custom scrollbar styling for better UX
    &::-webkit-scrollbar {
      width: rem-calc(8);
    }
    
    &::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: rem-calc(4);
    }
    
    &::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: rem-calc(4);
      
      &:hover {
        background: rgba(0, 0, 0, 0.3);
      }
    }
    
    // For Firefox
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) rgba(0, 0, 0, 0.05);
  }
  
  // Navbar collapse menu - needs to be scrollable at high zoom
  .navbar-collapse {
    // Desktop: allow overflow for dropdowns
    @include respond-above(lg) {
      overflow: visible !important;
    }
    
    // Mobile/High Zoom: enable scrolling for the menu itself
    @include respond-below(lg) {
      width: 100vw !important; // Full viewport width
      max-width: 100vw !important;
      margin-left: calc(-50vw + 50%) !important; // Center align to viewport
      max-height: 80vh; // Use viewport height instead of fixed calculation
      overflow-y: auto !important;
      overflow-x: hidden;
      padding-left: .25rem;
      padding-right: .25rem;
      
      // Custom scrollbar for mobile menu
      &::-webkit-scrollbar {
        width: rem-calc(8);
      }
      
      &::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
      }
      
      &::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: rem-calc(4);
        
        &:hover {
          background: rgba(0, 0, 0, 0.3);
        }
      }
      
      // Firefox
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.2) rgba(0, 0, 0, 0.05);
    }
    
    &.show {
      // When menu is open on mobile
      @include respond-below(lg) {
        overflow-y: auto !important;
      }
      
      @include respond-above(lg) {
        overflow: visible !important;
      }
    }
  }
  
  // Ensure navbar container allows overflow on desktop
  .navbar {
    @include respond-above(lg) {
      overflow: visible !important;
    }
    
    @include respond-below(lg) {
      overflow: hidden; // Contain the collapsible menu
    }
  }

  // Logo text styles
  span p.logo-text {
    font-size: rem-calc(10) !important;
    margin-bottom: 0 !important;
  }

  // Logo/Brand link with proper semantics
  .navbar-brand {
    display: inline-flex;
    align-items: center;
    text-decoration: none;
    
    // NOTE: Using centralized focus mixin
    &:focus-visible {
      @include focus-visible-styles;
    }
    
    img {
      // Ensure proper image rendering for crisp logos
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }
  }

  // Language selector with responsive positioning and accessibility
  .language-selector {
    @include respond-above(md) {
      order: 3;
      margin-left: 1rem;
    }

    // On mobile, ensure dropdown opens downward and is fully visible
    // @include respond-below(lg) {
    //   .dropdown-menu {
    //     position: absolute !important;
    //     inset: 0px auto auto 0px !important;
    //     margin: 0px !important;
    //     transform: translate(0px, 40px) !important; // Position below button
    //   }
    // }

    // On desktop, open dropdown to the left (dropstart behavior)
    @include respond-above(lg) {
      .dropdown-menu {
        right: rem-calc(24);
        left: auto;
      }
    }

    // @include respond-below(md) {
    //   position: fixed;
    //   right: rem-calc(60);
    //   top: rem-calc(30);
    //   transform: translateY(-50%);
    // }

    .dropdown-toggle {
      // WCAG 2.1 Level AAA touch target size
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      
      // NOTE: Using centralized focus mixin
      &:focus-visible {
        @include focus-visible-styles;
      }
    }
    
    // NOTE: dropdown-item styles are now in global .dropdown-menu .dropdown-item above
  }

  // Universal access icon (changed from div to span)
  .universal-access {
    display: inline-block;
    width: rem-calc(33);
    height: rem-calc(33);
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    pointer-events: none; // Prevent icon from being a separate target
  }

  // Navbar toggler (hamburger menu) with accessibility
  .navbar-toggler {
    padding: rem-calc(0 13);
    border: rem-calc(1) solid gray;
    border-radius: rem-calc(5);
    // WCAG 2.1 Level AAA touch target size
    min-width: 44px;
    min-height: 44px;
    
    &:focus-visible {
      outline: 2px solid currentColor;
      outline-offset: 2px;
      box-shadow: none; // Remove default Bootstrap shadow for cleaner focus
    }
  }

  // Dropdown menu positioning
  .dropstart .dropdown-menu[data-bs-popper] {
    top: 110%;
    right: 100%;
    left: -124%;
    z-index: 1200;
  }

  // Navigation items with accessibility enhancements
  .navbar-nav {
    // Ensure nav items wrap on mobile/high zoom
    @include respond-below(lg) {
      width: 100%;
      flex-wrap: wrap;
    }
    
    .nav-link {
      position: relative;
      padding: rem-calc(8 16);
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      text-decoration: none;
      white-space: normal; // Allow text to wrap
      word-wrap: break-word; // Break long words if needed
      
      // On mobile/high zoom, allow full width
      @include respond-below(lg) {
        width: 100%;
        flex-wrap: wrap;
      }
      
      // Enhanced focus indicator
      &:focus-visible {
        outline: 2px solid currentColor;
        outline-offset: 2px;
      }
      
      // Active state indicator with visual underline
      &.active {
        font-weight: 600;
        
        &::after {
          content: "";
          position: absolute;
          bottom: 0;
          left: rem-calc(16);
          right: rem-calc(16);
          height: rem-calc(3);
          background-color: currentColor;
        }
      }

      // Dropdown toggle as button (proper semantic)
      &.dropdown-toggle {
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        font-size: inherit;
        font-family: inherit;
        
        &:hover {
          color: inherit;
        }
      }
    }
    
    // Dropdown menu items accessibility
    // NOTE: Removed - consolidated into global .dropdown-menu .dropdown-item above
    
    // Ensure nav items on mobile have proper spacing
    .nav-item {
      @include respond-below(lg) {
        width: 100%;
      }
    }
  }

  // Ensure all interactive buttons have proper focus
  .btn-link {
    min-width: 44px;
    min-height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    
    &:focus-visible {
      outline: 2px solid currentColor;
      outline-offset: 2px;
    }

    &:hover {
      text-decoration: none;
    }
  }

  // Screen reader only text
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
}

// ============================================================================
// Media Queries for Enhanced Accessibility
// ============================================================================

// High contrast mode support
@media (prefers-contrast: high) {
  .c-header {
    border-bottom: rem-calc(2) solid currentColor;
  }
  
  .nav-link,
  .dropdown-toggle,
  .btn-link,
  .navbar-brand {
    border: rem-calc(1) solid currentColor;
  }
}

// Reduced motion support for users with vestibular disorders
@media (prefers-reduced-motion: reduce) {
  .c-header {
    .navbar-collapse {
      transition: none !important;
    }
    
    .dropdown-menu {
      transition: none !important;
    }

    .language-selector {
      transition: none !important;
      transform: none !important;
    }
  }
}

// Print styles for better document output
@media print {
  .c-header {
    position: static !important;
    box-shadow: none !important;
  }
  
  .navbar-toggler,
  .language-selector {
    display: none !important;
  }
}
